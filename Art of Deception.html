<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Urgent Community Crisis - Animated Manipulation Flowchart</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            min-height: 100vh;
            margin: 0;
            background-color: #f8f8f8;
            color: #333;
            padding: 20px;
            box-sizing: border-box;
        }
        h1 {
            color: #2c3e50;
            margin-bottom: 15px;
            text-align: center;
        }
        p.subtitle {
            font-size: 0.9em;
            color: #555;
            margin-bottom: 30px;
            text-align: center;
            max-width: 800px;
        }
        #flowchart-container {
            position: relative;
            width: 900px;
            height: 750px;
            border: 1px solid #ddd;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-sizing: border-box;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .flow-box {
            position: absolute;
            width: 250px;
            height: 150px;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            font-size: 0.9em;
            color: #333;
            box-sizing: border-box;
            transition: all 0.4s ease-in-out;
            border: 2px solid transparent;
            z-index: 1;
        }
        .flow-box.highlight {
            border-color: #e74c3c;
            box-shadow: 0 0 15px rgba(231, 76, 60, 0.6);
            transform: scale(1.03);
            z-index: 10;
        }

        /* Box colors from image */
        .box-pink { background-color: #ffe0e6; }
        .box-orange { background-color: #fff0e0; }
        .box-green { background-color: #e0f0e0; }
        .box-light-orange { background-color: #fff8e0; }

        /* Positioning */
        #box-1 { top: 30px; left: 30px; }
        #box-2 { top: 30px; left: 320px; }
        #box-3 { top: 30px; left: 610px; }

        #box-4 { top: 260px; left: 30px; }
        #box-5 { top: 260px; left: 320px; }
        #box-6 { top: 260px; left: 610px; }

        #box-7 { top: 490px; left: 30px; }
        #box-8 { top: 490px; left: 320px; }
        #box-9 { top: 490px; left: 610px; }

        /* SVG Arrows */
        svg.arrows {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: 0;
        }
        .flow-arrow {
            stroke: #666;
            stroke-width: 3;
            fill: none;
            marker-end: url(#arrowhead);
            transition: stroke 0.4s ease-in-out, stroke-width 0.4s ease-in-out, opacity 0.4s ease-in-out;
            opacity: 0;
        }
        .flow-arrow.highlight {
            stroke: #e74c3c;
            stroke-width: 4;
            opacity: 1;
            z-index: 5;
        }

        /* Icons inside boxes */
        .box-icon {
            margin-bottom: 5px;
            height: 50px;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden; /* Important for icons that might expand */
        }
        .box-icon svg {
            height: 100%;
            width: auto;
            max-width: 80%;
        }
        .box-icon svg path, .box-icon svg circle, .box-icon svg rect, .box-icon svg polygon, .box-icon svg line {
            fill: #555; /* Default icon color */
            stroke: none; /* Default stroke none for paths */
            transition: fill 0.4s ease-in-out, stroke 0.4s ease-in-out;
            transform-origin: center center; /* Important for transforms */
        }
        /* Specific elements within SVGs that need a stroke */
        .box-icon #magnifying-glass-outline, .box-icon #gear-outline, .box-icon #bomb-fuse-outline, .box-icon #megaphone-outline {
             stroke: #555;
             stroke-width: 2px;
             fill: none;
        }
        
        .box-text, .small-text {
            font-weight: bold;
            margin-top: 5px;
            transition: color 0.4s ease-in-out;
        }
        .small-text {
            font-size: 0.8em;
            color: #666;
            font-weight: normal;
        }

        /* Highlight styles for contents of the highlighted box */
        .flow-box.highlight .box-icon svg path,
        .flow-box.highlight .box-icon svg circle,
        .flow-box.highlight .box-icon svg rect,
        .flow-box.highlight .box-icon svg polygon,
        .flow-box.highlight .box-icon svg line {
            fill: #e74c3c; /* Change icon color to red */
        }
        .flow-box.highlight .box-icon #magnifying-glass-outline,
        .flow-box.highlight .box-icon #gear-outline,
        .flow-box.highlight .box-icon #bomb-fuse-outline,
        .flow-box.highlight .box-icon #megaphone-outline {
            stroke: #e74c3c;
        }
        .flow-box.highlight .box-text {
            color: #e74c3c; /* Change main text color to red */
        }
        .flow-box.highlight .small-text {
            color: #c0392b; /* Slightly darker red for sub-text */
        }

        /* ANIMATIONS */

        /* 1. Identifying Target: Thought bubble pulse */
        @keyframes thoughtBubblePulse {
            0% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(0.8); opacity: 0; }
        }
        .flow-box.highlight #thought-bubble {
            animation: thoughtBubblePulse 2s ease-in-out infinite;
        }
        #thought-bubble { opacity: 0; transform-origin: bottom center; } /* Hidden by default */

        /* 2. Analyzing Vulnerabilities: Eye blink */
        @keyframes eyeBlink {
            0%, 20%, 40%, 100% { transform: scaleY(1); }
            10%, 30% { transform: scaleY(0.1); }
        }
        .flow-box.highlight #eye-lid {
            animation: eyeBlink 3s infinite;
        }

        /* 3. Information Gathering: Magnifying glass shine */
        @keyframes shine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        #shine-rect {
            fill: white;
            opacity: 0.6;
            transform: translateX(-100%);
            transform-origin: center center;
        }
        .flow-box.highlight #shine-rect {
            animation: shine 1.5s linear infinite;
        }
        .flow-box.highlight #magnifying-glass-paper {
             animation: paperWiggle 0.5s ease-in-out infinite alternate;
        }
        @keyframes paperWiggle {
            0% { transform: translateX(0); }
            100% { transform: translateX(2px) rotate(1deg); }
        }

        /* 4. Crafting Deception: Bomb fuse flicker and pulse */
        @keyframes fuseFlicker {
            0%, 100% { transform: scaleX(1); opacity: 1; }
            50% { transform: scaleX(0.8); opacity: 0.7; }
        }
        @keyframes bombPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        .flow-box.highlight #bomb-fuse {
            animation: fuseFlicker 0.8s infinite alternate;
        }
        .flow-box.highlight #bomb-body {
            animation: bombPulse 1.5s infinite alternate;
        }

        /* 5. Refining Strategy: Gear spin */
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .flow-box.highlight #gear-tooth {
            animation: spin 3s linear infinite;
        }

        /* 6. Disseminating Narrative: Sound waves */
        @keyframes soundWave {
            0% { transform: scaleX(0.8); opacity: 0; }
            50% { transform: scaleX(1.2); opacity: 1; }
            100% { transform: scaleX(0.8); opacity: 0; }
        }
        .flow-box.highlight #sound-wave-1 { animation: soundWave 2s 0s infinite; }
        .flow-box.highlight #sound-wave-2 { animation: soundWave 2s 0.3s infinite; } /* Staggered */
        .flow-box.highlight #sound-wave-3 { animation: soundWave 2s 0.6s infinite; }

        /* 7. Exploiting the Crowd: Question marks bounce */
        @keyframes qMarkBounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        .flow-box.highlight #q-mark-1, .flow-box.highlight #q-mark-2 {
            animation: qMarkBounce 1s ease-in-out infinite alternate;
        }
        #q-mark-1, #q-mark-2 { opacity: 0; transform-origin: bottom center; } /* Hidden by default */

        /* 8. Amplification & Reaction: Speech bubbles pop */
        @keyframes bubblePop {
            0% { transform: scale(0); opacity: 0; }
            50% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }
        .flow-box.highlight #bubble-1 { animation: bubblePop 0.8s ease-out forwards; }
        .flow-box.highlight #bubble-2 { animation: bubblePop 0.8s 0.2s ease-out forwards; }
        #bubble-1, #bubble-2 { transform: scale(0); opacity: 0; transform-origin: center center;}

        /* 9. Payoff & Disappearance: Money bag bounce, figure fade */
        @keyframes moneyBagBounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-3px); }
        }
        @keyframes figureFade {
            0% { opacity: 1; }
            100% { opacity: 0; transform: translateY(-10px); }
        }
        .flow-box.highlight #money-bag {
            animation: moneyBagBounce 0.8s ease-in-out infinite alternate;
        }
        .flow-box.highlight #disappearing-figure {
            animation: figureFade 3s ease-out forwards; /* Only play once */
        }
        #disappearing-figure { opacity: 1; } /* Visible by default */


        /* Controls */
        .controls {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-top: 30px;
            font-size: 1.1em;
            background-color: #fff;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        }
        button {
            padding: 12px 25px;
            font-size: 1em;
            cursor: pointer;
            border: none;
            border-radius: 6px;
            background-color: #3498db;
            color: white;
            transition: background-color 0.2s ease-in-out, transform 0.1s ease-in-out;
        }
        button:hover:not(:disabled) {
            background-color: #2980b9;
            transform: translateY(-1px);
        }
        button:active:not(:disabled) {
            transform: translateY(0);
        }
        button:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
        }
        #phase-explanation {
            margin-top: 20px;
            width: 80%;
            max-width: 800px;
            padding: 15px;
            background-color: #eaf6ff;
            border: 1px solid #b3e0ff;
            border-radius: 8px;
            text-align: center;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            font-size: 1em;
            color: #0056b3;
        }
        #phase-description-text {
            font-weight: bold;
            color: #007bff;
        }
    </style>
</head>
<body>
    <h1>Urgent Community Crisis: The Animated Manipulation Flow</h1>
    <p class="subtitle">A step-by-step animation of how a community can be manipulated, based on the provided flowchart.</p>

    <div id="flowchart-container">
        <!-- SVG for arrows -->
        <svg class="arrows" xmlns="http://www.w3.org/2000/svg">
            <defs>
                <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                    <polygon points="0 0, 10 3.5, 0 7" style="fill:#e74c3c;" />
                </marker>
            </defs>
            <!-- Top row horizontal arrows -->
            <line id="arrow-1-2" class="flow-arrow" x1="280" y1="105" x2="320" y2="105" />
            <line id="arrow-2-3" class="flow-arrow" x1="570" y1="105" x2="610" y2="105" />
            
            <!-- Mid row horizontal arrows -->
            <line id="arrow-4-5" class="flow-arrow" x1="280" y1="335" x2="320" y2="335" />
            <line id="arrow-5-6" class="flow-arrow" x1="570" y1="335" x2="610" y2="335" />

            <!-- Bottom row horizontal arrows -->
            <line id="arrow-7-8" class="flow-arrow" x1="280" y1="565" x2="320" y2="565" />
            <line id="arrow-8-9" class="flow-arrow" x1="570" y1="565" x2="610" y2="565" />

            <!-- Vertical arrows (connecting main column flow) -->
            <line id="arrow-3-6" class="flow-arrow" x1="735" y1="180" x2="735" y2="260" />
            <line id="arrow-6-9" class="flow-arrow" x1="735" y1="410" x2="735" y2="490" />
        </svg>

        <!-- Flowchart Boxes -->
        <div id="box-1" class="flow-box box-pink">
            <div class="box-icon">
                <svg viewBox="0 0 100 100">
                    <circle cx="25" cy="40" r="15" />
                    <path d="M5 75 C 5 60, 45 60, 45 75 L 45 90 L 5 90 Z" />
                    <circle cx="70" cy="40" r="15" />
                    <path d="M50 75 C 50 60, 90 60, 90 75 L 90 90 L 50 90 Z" />
                    <path id="thought-bubble" d="M35 25 C 35 15, 45 10, 55 10 C 65 10, 75 15, 75 25 C 75 35, 65 40, 55 40 C 50 40, 45 35, 40 30 L 35 30 L 35 25 Z" />
                </svg>
            </div>
            <div class="box-text">Identifying Target</div>
        </div>

        <div id="box-2" class="flow-box box-pink">
            <div class="box-icon">
                <svg viewBox="0 0 100 100">
                    <path d="M50 85 C 20 85, 5 50, 50 15 C 95 50, 80 85, 50 85 Z" fill="#ccc"/>
                    <circle cx="50" cy="50" r="20" fill="white" />
                    <circle id="eye-lid" cx="50" cy="50" r="20" fill="#555" />
                    <circle cx="50" cy="50" r="10" fill="#333" />
                </svg>
            </div>
            <div class="box-text">Analyzing Vulnerabilities</div>
            <div class="small-text">(Original: Lalloininstts)</div>
        </div>

        <div id="box-3" class="flow-box box-orange">
            <div class="box-icon">
                <svg viewBox="0 0 100 100">
                    <rect id="magnifying-glass-paper" x="10" y="50" width="80" height="30" rx="5" fill="#f0f0f0" />
                    <circle cx="45" cy="40" r="25" fill="white" />
                    <circle id="magnifying-glass-outline" cx="45" cy="40" r="25" fill="none" stroke="#555" stroke-width="4" />
                    <line x1="65" y1="60" x2="85" y2="80" stroke="#555" stroke-width="6" stroke-linecap="round" />
                    <rect id="shine-rect" x="30" y="25" width="20" height="30" transform="rotate(45 45 40)"/>
                </svg>
            </div>
            <div class="box-text">Information Gathering</div>
        </div>

        <div id="box-4" class="flow-box box-green">
            <div class="box-icon">
                <svg viewBox="0 0 100 100">
                    <circle id="bomb-body" cx="50" cy="65" r="25" />
                    <rect x="47" y="30" width="6" height="30" rx="3" />
                    <path id="bomb-fuse" d="M50 30 L60 10 L70 20" fill="none" stroke-width="4" stroke-linecap="round" />
                    <path id="bomb-fuse-outline" d="M50 30 L60 10 L70 20" fill="none" stroke="#555" stroke-width="4" stroke-linecap="round" />
                    <circle cx="65" cy="15" r="5" fill="#e74c3c" />
                </svg>
            </div>
            <div class="box-text">Crafting the Deception</div>
            <div class="small-text">(Crisis Narratum)</div>
        </div>

        <div id="box-5" class="flow-box box-orange">
            <div class="box-icon">
                <svg viewBox="0 0 100 100">
                    <circle cx="50" cy="50" r="35" fill="#f0f0f0"/>
                    <circle id="gear-outline" cx="50" cy="50" r="35" fill="none" stroke="#555" stroke-width="4"/>
                    <circle cx="50" cy="50" r="10" />
                    <g id="gear-tooth">
                        <rect x="45" y="10" width="10" height="15" rx="2"/>
                        <rect x="75" y="45" width="15" height="10" rx="2" transform="rotate(90 50 50)"/>
                        <rect x="45" y="75" width="10" height="15" rx="2" transform="rotate(180 50 50)"/>
                        <rect x="10" y="45" width="15" height="10" rx="2" transform="rotate(270 50 50)"/>
                    </g>
                </svg>
            </div>
            <div class="box-text">Refining Strategy</div>
            <div class="small-text">(Original: Crifting aher Piepination)</div>
        </div>

        <div id="box-6" class="flow-box box-orange">
            <div class="box-icon">
                <svg viewBox="0 0 100 100">
                    <path id="megaphone-outline" d="M10 40 L30 40 L60 10 L80 10 L80 60 L60 60 L30 90 L10 90 Z" fill="none" stroke="#555" stroke-width="4"/>
                    <path d="M10 40 L30 40 L60 10 L80 10 L80 60 L60 60 L30 90 L10 90 Z" fill="#f0f0f0"/>
                    <rect x="5" y="45" width="10" height="20" fill="#555"/>
                    <path id="sound-wave-1" d="M85 35 C 95 30, 95 60, 85 55" fill="none" stroke="#555" stroke-width="4" stroke-linecap="round" />
                    <path id="sound-wave-2" d="M80 25 C 90 20, 90 70, 80 65" fill="none" stroke="#555" stroke-width="4" stroke-linecap="round" />
                    <path id="sound-wave-3" d="M75 15 C 85 10, 85 80, 75 75" fill="none" stroke="#555" stroke-width="4" stroke-linecap="round" />
                </svg>
            </div>
            <div class="box-text">Disseminating Narrative</div>
            <div class="small-text">(Original: Disppairing)</div>
        </div>

        <div id="box-7" class="flow-box box-pink">
            <div class="box-icon">
                <svg viewBox="0 0 100 100">
                    <circle cx="30" cy="40" r="15" />
                    <path d="M10 75 C 10 60, 50 60, 50 75 L 50 90 L 10 90 Z" />
                    <circle cx="70" cy="40" r="15" />
                    <path d="M50 75 C 50 60, 90 60, 90 75 L 90 90 L 50 90 Z" />
                    <text id="q-mark-1" x="30" y="25" font-family="Arial" font-size="20" text-anchor="middle" fill="#555">?</text>
                    <text id="q-mark-2" x="70" y="25" font-family="Arial" font-size="20" text-anchor="middle" fill="#555">?</text>
                </svg>
            </div>
            <div class="box-text">Exploiting the Crowd</div>
        </div>

        <div id="box-8" class="flow-box box-light-orange">
            <div class="box-icon">
                <svg viewBox="0 0 100 100">
                    <path id="bubble-1" d="M30 60 L10 40 L30 20 L50 40 L30 60 Z" fill="#f0f0f0" stroke="#555" stroke-width="2" />
                    <text id="bubble-text-1" x="30" y="35" font-family="Arial" font-size="20" text-anchor="middle" fill="#555" opacity="0">?</text>
                    <path id="bubble-2" d="M70 60 L50 40 L70 20 L90 40 L70 60 Z" fill="#f0f0f0" stroke="#555" stroke-width="2" />
                    <text id="bubble-text-2" x="70" y="35" font-family="Arial" font-size="20" text-anchor="middle" fill="#555" opacity="0">?</text>
                </svg>
            </div>
            <div class="box-text">Amplification & Reaction</div>
            <div class="small-text">(Original: Exispregnawce)</div>
        </div>

        <div id="box-9" class="flow-box box-orange">
            <div class="box-icon">
                <svg viewBox="0 0 100 100">
                    <path id="money-bag" d="M40 90 C 20 90, 10 70, 10 50 C 10 30, 20 20, 40 20 L60 20 C 80 20, 90 30, 90 50 C 90 70, 80 90, 60 90 Z" fill="#f0f0f0" stroke="#555" stroke-width="2" />
                    <line x1="40" y1="25" x2="60" y2="25" stroke="#555" stroke-width="4" stroke-linecap="round" />
                    <line x1="45" y1="20" x2="55" y2="30" stroke="#555" stroke-width="2" stroke-linecap="round" />
                    <line x1="45" y1="30" x2="55" y2="20" stroke="#555" stroke-width="2" stroke-linecap="round" />

                    <path id="disappearing-figure" d="M75 50 C 75 40, 85 40, 85 50 C 85 60, 75 60, 75 50 Z M70 80 C 70 70, 90 70, 90 80 L 90 90 L 70 90 Z" fill="#555" />
                </svg>
            </div>
            <div class="box-text">Payoff & Disappearance</div>
            <div class="small-text">(Original: Payoff & dissaparce)</div>
        </div>
    </div>

    <div class="controls">
        <button id="prevBtn" disabled>Previous Step</button>
        <button id="nextBtn">Next Step</button>
        <p>Step <span id="currentStepNumber">0</span> of <span id="totalStepsNumber"></span></p>
    </div>
    <div id="phase-explanation">
        <span id="phase-description-text">Click "Next Step" to begin the animation.</span>
    </div>

    <script>
        const flowchartBoxes = [
            null, // Step 0 is just initial state, no box highlighted
            { id: 'box-1', arrow: null, description: 'Step 1: Identifying Target - The manipulator observes individuals and groups, looking for common traits, interests, and potential vulnerabilities like existing anxieties or desires.' },
            { id: 'box-2', arrow: 'arrow-1-2', description: 'Step 2: Analyzing Vulnerabilities - A deeper analysis is performed. The manipulator studies social connections, existing beliefs, and emotional triggers to refine their understanding of the target. (Based on "Lalloininstts")' },
            { id: 'box-3', arrow: 'arrow-2-3', description: 'Step 3: Information Gathering - Extensive data is collected, including existing narratives and influential figures within the community. This ensures the false narrative can be made credible and resonate effectively.' },
            { id: 'box-4', arrow: 'arrow-3-6', description: 'Step 4: Crafting the Deception / Crisis Narrative - A plausible, emotionally charged false narrative ("the crisis") is meticulously constructed. It\'s designed to tap into the identified vulnerabilities and fears. (Original: "Crisis Narratum" in Box 4, but this step represents the *creation* which then leads to Box 6 for dissemination, following the vertical arrow in the original diagram\'s main flow.)' },
            { id: 'box-5', arrow: 'arrow-4-5', description: 'Step 5: Refining Strategy - The crafted narrative is refined, potentially tested, and a detailed strategy for its dissemination and amplification is planned. This includes selecting distribution channels and identifying initial unwitting messengers. (Based on "Crifting aher Piepination" in Box 5)' },
            { id: 'box-6', arrow: 'arrow-5-6', description: 'Step 6: Disseminating Narrative - The engineered crisis narrative is actively launched and pushed into the community through chosen channels. This marks the beginning of its active spread among the target audience. (Based on "Disppairing" in Box 6)' },
            { id: 'box-7', arrow: 'arrow-6-9', description: 'Step 7: Exploiting the Crowd - As the false narrative gains traction and belief, the manipulator begins to direct the community\'s emotional responses and collective energy towards specific actions that directly serve the manipulator\'s agenda. (Original: "Expliting the Crowd" in Box 7, but this step represents the *outcome* of previous dissemination, leading to Box 9 for the payoff, following the vertical arrow.)' },
            { id: 'box-8', arrow: 'arrow-7-8', description: 'Step 8: Amplification & Reaction - The manipulated crowd\'s reactions, which can include widespread confusion, strong emotional responses, or further sharing, amplifies the false narrative. This makes it increasingly difficult for rational thought or truth to emerge. (Based on "Exispregnawce" in Box 8)' },
            { id: 'box-9', arrow: 'arrow-8-9', description: 'Step 9: Payoff & Disappearance - The manipulator achieves their ultimate objective (e.g., financial gain, political influence, social disruption). Once the goal is met, they disengage or disappear, leaving the exploited and often damaged community behind. (Based on "Payoff & dissaparce" in Box 9)' },
        ];

        let currentStep = 0;
        const totalSteps = flowchartBoxes.length - 1;

        const nextBtn = document.getElementById('nextBtn');
        const prevBtn = document.getElementById('prevBtn');
        const phaseExplanation = document.getElementById('phase-description-text');
        const currentStepNumber = document.getElementById('currentStepNumber');
        const totalStepsNumber = document.getElementById('totalStepsNumber');

        totalStepsNumber.textContent = totalSteps;

        // Function to reset all animations
        function resetAnimations() {
            document.querySelectorAll('.box-icon svg *').forEach(el => {
                el.style.animation = ''; // Clear animation property
            });
            // Specific elements that change visibility
            document.getElementById('thought-bubble').style.opacity = 0;
            document.getElementById('q-mark-1').style.opacity = 0;
            document.getElementById('q-mark-2').style.opacity = 0;
            document.getElementById('bubble-1').style.transform = 'scale(0)';
            document.getElementById('bubble-1').style.opacity = 0;
            document.getElementById('bubble-2').style.transform = 'scale(0)';
            document.getElementById('bubble-2').style.opacity = 0;
            document.getElementById('disappearing-figure').style.opacity = 1;
            document.getElementById('disappearing-figure').style.transform = 'translateY(0)';
            document.getElementById('shine-rect').style.transform = 'translateX(-100%)';
            document.getElementById('magnifying-glass-paper').style.transform = 'translateX(0) rotate(0)';
        }

        function updateFlowchart() {
            // Remove highlight from all boxes and arrows first
            document.querySelectorAll('.flow-box').forEach(box => box.classList.remove('highlight'));
            document.querySelectorAll('.flow-arrow').forEach(arrow => arrow.classList.remove('highlight'));
            
            // Reset animations for all icons before applying to the current one
            resetAnimations();

            currentStepNumber.textContent = currentStep;

            if (currentStep === 0) {
                phaseExplanation.textContent = 'Click "Next Step" to begin the animation.';
            } else {
                const currentPhase = flowchartBoxes[currentStep];
                // Highlight the current box
                const currentBox = document.getElementById(currentPhase.id);
                currentBox.classList.add('highlight');
                
                // Highlight the arrow *leading to* this step (if defined)
                if (currentPhase.arrow) {
                    document.getElementById(currentPhase.arrow).classList.add('highlight');
                }
                phaseExplanation.textContent = currentPhase.description;

                // Trigger specific animations for the highlighted box's icon
                // This is where specific animation logic for each box goes
                switch(currentPhase.id) {
                    case 'box-1':
                        document.getElementById('thought-bubble').style.animation = 'thoughtBubblePulse 2s ease-in-out infinite';
                        break;
                    case 'box-2':
                        document.getElementById('eye-lid').style.animation = 'eyeBlink 3s infinite';
                        break;
                    case 'box-3':
                        document.getElementById('shine-rect').style.animation = 'shine 1.5s linear infinite';
                        document.getElementById('magnifying-glass-paper').style.animation = 'paperWiggle 0.5s ease-in-out infinite alternate';
                        break;
                    case 'box-4':
                        document.getElementById('bomb-fuse').style.animation = 'fuseFlicker 0.8s infinite alternate';
                        document.getElementById('bomb-body').style.animation = 'bombPulse 1.5s infinite alternate';
                        break;
                    case 'box-5':
                        document.getElementById('gear-tooth').style.animation = 'spin 3s linear infinite';
                        break;
                    case 'box-6':
                        document.getElementById('sound-wave-1').style.animation = 'soundWave 2s 0s infinite';
                        document.getElementById('sound-wave-2').style.animation = 'soundWave 2s 0.3s infinite';
                        document.getElementById('sound-wave-3').style.animation = 'soundWave 2s 0.6s infinite';
                        break;
                    case 'box-7':
                        document.getElementById('q-mark-1').style.animation = 'qMarkBounce 1s ease-in-out infinite alternate';
                        document.getElementById('q-mark-2').style.animation = 'qMarkBounce 1s 0.2s ease-in-out infinite alternate';
                        break;
                    case 'box-8':
                        document.getElementById('bubble-1').style.animation = 'bubblePop 0.8s ease-out forwards';
                        document.getElementById('bubble-2').style.animation = 'bubblePop 0.8s 0.2s ease-out forwards';
                        document.getElementById('bubble-text-1').style.opacity = 1;
                        document.getElementById('bubble-text-2').style.opacity = 1;
                        break;
                    case 'box-9':
                        document.getElementById('money-bag').style.animation = 'moneyBagBounce 0.8s ease-in-out infinite alternate';
                        document.getElementById('disappearing-figure').style.animation = 'figureFade 3s ease-out forwards';
                        break;
                }
            }

            // Update button states
            prevBtn.disabled = currentStep === 0;
            nextBtn.disabled = currentStep === totalSteps;
        }

        nextBtn.addEventListener('click', () => {
            if (currentStep < totalSteps) {
                currentStep++;
                updateFlowchart();
            }
        });

        prevBtn.addEventListener('click', () => {
            if (currentStep > 0) {
                currentStep--;
                updateFlowchart();
            }
        });

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', updateFlowchart);
    </script>
</body>
</html>
