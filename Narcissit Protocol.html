<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Narcissus Protocol: The Self-Centered Manipulation Flow</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Share+Tech+Mono&display=swap');

        :root {
            --bg-dark: #1a1a2e;
            --bg-medium: #2a2a4a;
            --text-light: #e0e0e0;
            --text-medium: #a0a0c0;
            --accent-blue: #00bcd4; /* Cyan */
            --accent-purple: #8e44ad;
            --accent-green: #2ecc71;
            --highlight-red: #e74c3c; /* Still a strong red for danger/manipulation */
            --glow-red: #ff0055;
            --glow-blue: #00ffff; /* Neon Blue */
            --glow-purple: #ff00ff; /* Magenta */
            --border-color: #3f3f5a;
            --box-bg-normal: #333355;
            --box-bg-highlight: #444466;
        }

        body {
            font-family: 'Share Tech Mono', monospace, Arial, sans-serif; /* Futuristic font */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            min-height: 100vh;
            margin: 0;
            background-color: var(--bg-dark);
            color: var(--text-light);
            padding: 20px;
            box-sizing: border-box;
            overflow-x: hidden; /* Prevent horizontal scroll */
        }
        h1 {
            font-family: 'Orbitron', sans-serif; /* More impactful font for title */
            color: var(--glow-blue);
            text-shadow: 0 0 10px var(--glow-blue), 0 0 20px var(--glow-blue);
            margin-bottom: 15px;
            text-align: center;
            letter-spacing: 2px;
        }
        p.subtitle {
            font-size: 0.9em;
            color: var(--text-medium);
            margin-bottom: 30px;
            text-align: center;
            max-width: 800px;
        }
        #flowchart-container {
            position: relative;
            width: 900px;
            height: 750px;
            border: 1px solid var(--border-color);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.2); /* Subtle blue glow */
            background-color: var(--bg-medium);
            padding: 20px;
            border-radius: 8px;
            box-sizing: border-box;
            display: flex;
            justify-content: center;
            align-items: center;
            perspective: 1000px; /* For 3D transforms */
        }
        .flow-box {
            position: absolute;
            width: 250px;
            height: 150px;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            font-size: 0.9em;
            color: var(--text-light);
            box-sizing: border-box;
            transition: all 0.4s ease-in-out, box-shadow 0.6s ease-in-out;
            border: 2px solid var(--border-color);
            background-color: var(--box-bg-normal);
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5); /* Inner shadow for depth */
            z-index: 1;
            transform-style: preserve-3d; /* For child transforms */
        }
        .flow-box.highlight {
            border-color: var(--glow-red);
            box-shadow: 0 0 15px var(--glow-red), 0 0 30px rgba(255, 0, 85, 0.4); /* Stronger glow */
            transform: scale(1.05) rotateY(5deg); /* Slight 3D tilt */
            z-index: 10;
            background-color: var(--box-bg-highlight);
        }

        /* Positioning - unchanged */
        #box-1 { top: 30px; left: 30px; }
        #box-2 { top: 30px; left: 320px; }
        #box-3 { top: 30px; left: 610px; }
        #box-4 { top: 260px; left: 30px; }
        #box-5 { top: 260px; left: 320px; }
        #box-6 { top: 260px; left: 610px; }
        #box-7 { top: 490px; left: 30px; }
        #box-8 { top: 490px; left: 320px; }
        #box-9 { top: 490px; left: 610px; }

        /* SVG Arrows */
        svg.arrows {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: 0;
        }
        .flow-arrow {
            stroke: var(--text-medium);
            stroke-width: 2;
            fill: none;
            marker-end: url(#arrowhead);
            transition: stroke 0.4s ease-in-out, stroke-width 0.4s ease-in-out, opacity 0.4s ease-in-out;
            opacity: 0.5; /* Always slightly visible but muted */
        }
        .flow-arrow.highlight {
            stroke: var(--glow-red);
            stroke-width: 4;
            opacity: 1;
            z-index: 5;
            filter: drop-shadow(0 0 5px var(--glow-red)); /* Glow for arrows */
        }
        #arrowhead polygon { fill: var(--text-medium); transition: fill 0.4s ease-in-out; }

        /* Icons inside boxes */
        .box-icon {
            margin-bottom: 5px;
            height: 60px; /* Slightly larger icons */
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }
        .box-icon svg {
            height: 100%;
            width: auto;
            max-width: 80%;
        }
        .box-icon svg path, .box-icon svg circle, .box-icon svg rect, .box-icon svg polygon, .box-icon svg line {
            fill: var(--text-medium);
            stroke: none;
            transition: fill 0.4s ease-in-out, stroke 0.4s ease-in-out;
            transform-origin: center center;
            vector-effect: non-scaling-stroke; /* Keep stroke width consistent on zoom */
        }
        .box-icon svg .stroke-element {
            stroke: var(--text-medium);
            stroke-width: 2px;
            fill: none;
            transition: stroke 0.4s ease-in-out;
        }
        
        .box-text, .small-text {
            font-weight: bold;
            margin-top: 5px;
            transition: color 0.4s ease-in-out;
            letter-spacing: 0.5px;
        }
        .small-text {
            font-size: 0.8em;
            color: var(--text-medium);
            font-weight: normal;
        }

        /* Highlight styles for contents of the highlighted box */
        .flow-box.highlight .box-icon svg path,
        .flow-box.highlight .box-icon svg circle,
        .flow-box.highlight .box-icon svg rect,
        .flow-box.highlight .box-icon svg polygon,
        .flow-box.highlight .box-icon svg line {
            fill: var(--glow-blue); /* Glowing blue for icons */
        }
        .flow-box.highlight .box-icon svg .stroke-element {
            stroke: var(--glow-blue);
        }
        .flow-box.highlight .box-text {
            color: var(--glow-blue);
            text-shadow: 0 0 5px var(--glow-blue);
        }
        .flow-box.highlight .small-text {
            color: var(--accent-blue);
        }

        /* ANIMATIONS */
        /* Reset all animations for elements not highlighted */
        .box-icon svg * { animation: none !important; }

        /* 1. Identify Sources: Mirror shimmer */
        @keyframes mirrorShimmer {
            0% { opacity: 0.5; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.05); }
            100% { opacity: 0.5; transform: scale(1); }
        }
        .flow-box.highlight #mirror-surface {
            animation: mirrorShimmer 2s ease-in-out infinite;
        }
        #mirror-surface { opacity: 0.7; }

        /* 2. Evaluate Utility: Thought bubble pulse */
        @keyframes thoughtBubblePulse {
            0% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(0.8); opacity: 0; }
        }
        .flow-box.highlight #thought-bubble-self {
            animation: thoughtBubblePulse 2.5s ease-in-out infinite;
        }
        #thought-bubble-self { opacity: 0; }

        /* 3. Curate Self-Image: Face sculpting/glowing outline */
        @keyframes faceOutlineGrow {
            0% { stroke-dasharray: 0 100; opacity: 0; }
            100% { stroke-dasharray: 100 0; opacity: 1; }
        }
        .flow-box.highlight #face-outline {
            animation: faceOutlineGrow 1.5s ease-out forwards;
        }
        #face-outline { stroke-dasharray: 0 100; opacity: 0; } /* Hidden by default */
        
        /* 4. Craft Initial Appeal: Spotlight effect */
        @keyframes spotlightGlow {
            0% { opacity: 0.5; }
            50% { opacity: 1; }
            100% { opacity: 0.5; }
        }
        @keyframes figurePulse {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-2px); }
        }
        .flow-box.highlight #spotlight-beam {
            animation: spotlightGlow 1.5s ease-in-out infinite;
        }
        .flow-box.highlight #spotlight-figure {
            animation: figurePulse 1s ease-in-out infinite alternate;
        }
        #spotlight-beam { opacity: 0; } /* Hidden by default */

        /* 5. Refine Attraction: Like count increment */
        @keyframes likeCountPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        @keyframes likeCounter {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .flow-box.highlight #like-heart, .flow-box.highlight #like-count {
            animation: likeCountPulse 1s ease-in-out infinite alternate;
        }
        .flow-box.highlight #like-count-display {
             animation: likeCounter 0.5s ease-out forwards;
        }
        #like-count-display { opacity: 0; }


        /* 6. Project Self-Image: Emitting waves of charisma */
        @keyframes charismaWave {
            0% { transform: scale(0); opacity: 0; }
            50% { transform: scale(1); opacity: 1; }
            100% { transform: scale(1.5); opacity: 0; }
        }
        .flow-box.highlight #charisma-wave-1 { animation: charismaWave 2s ease-out infinite; }
        .flow-box.highlight #charisma-wave-2 { animation: charismaWave 2s 0.5s ease-out infinite; }
        #charisma-wave-1, #charisma-wave-2 { opacity: 0; transform: scale(0); }

        /* 7. Extract Admiration: Orbs flowing towards figure */
        @keyframes orbFlow {
            0% { transform: translate(20px, 0px) scale(0.5); opacity: 0; }
            50% { transform: translate(0px, 0px) scale(1); opacity: 1; }
            100% { transform: translate(-20px, 0px) scale(0.5); opacity: 0; }
        }
        .flow-box.highlight #orb-1 { animation: orbFlow 1.5s ease-in-out infinite; }
        .flow-box.highlight #orb-2 { animation: orbFlow 1.5s 0.5s ease-in-out infinite; }
        .flow-box.highlight #orb-3 { animation: orbFlow 1.5s 1s ease-in-out infinite; }
        #orb-1, #orb-2, #orb-3 { opacity: 0; transform: translate(20px, 0px) scale(0.5); }

        /* 8. Leverage Supply: Figure scales up, crown glows */
        @keyframes figureGrow {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        @keyframes crownGlow {
            0% { opacity: 0.7; transform: translateY(0); }
            50% { opacity: 1; transform: translateY(-2px); }
            100% { opacity: 0.7; transform: translateY(0); }
        }
        .flow-box.highlight #manipulator-figure {
            animation: figureGrow 2s ease-in-out infinite alternate;
        }
        .flow-box.highlight #crown-element {
            animation: crownGlow 1.5s ease-in-out infinite alternate;
        }

        /* 9. Discard / Seek New Supply: Old sources crack, new appear */
        @keyframes crackFade {
            0% { stroke-dasharray: 0 100; opacity: 0; }
            50% { stroke-dasharray: 100 0; opacity: 1; }
            100% { opacity: 0; }
        }
        @keyframes newSourceGlow {
            0% { opacity: 0; transform: scale(0.5); }
            100% { opacity: 1; transform: scale(1); }
        }
        .flow-box.highlight #cracked-surface {
            animation: crackFade 2s ease-out forwards;
        }
        .flow-box.highlight #new-source-orb {
            animation: newSourceGlow 1s 1.5s ease-out forwards;
        }
        #cracked-surface { opacity: 0; stroke-dasharray: 0 100; }
        #new-source-orb { opacity: 0; transform: scale(0.5); }


        /* Controls */
        .controls {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-top: 30px;
            font-size: 1.1em;
            background-color: var(--bg-medium);
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.2);
        }
        button {
            padding: 12px 25px;
            font-size: 1em;
            cursor: pointer;
            border: none;
            border-radius: 6px;
            background-color: var(--accent-blue);
            color: var(--bg-dark);
            font-weight: bold;
            transition: background-color 0.2s ease-in-out, transform 0.1s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        button:hover:not(:disabled) {
            background-color: var(--glow-blue);
            transform: translateY(-1px);
            box-shadow: 0 0 8px var(--glow-blue);
        }
        button:active:not(:disabled) {
            transform: translateY(0);
        }
        button:disabled {
            background-color: var(--border-color);
            color: var(--text-medium);
            cursor: not-allowed;
            box-shadow: none;
        }
        #currentStepText {
            color: var(--text-light);
        }
        #phase-explanation {
            margin-top: 20px;
            width: 80%;
            max-width: 800px;
            padding: 15px;
            background-color: var(--bg-medium);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            text-align: center;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 15px rgba(255, 0, 85, 0.2); /* Red glow for explanations */
            font-size: 1em;
            color: var(--text-light);
        }
        #phase-description-text {
            font-weight: bold;
            color: var(--glow-red);
        }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
</head>
<body>
    <h1>NARCISSUS PROTOCOL: SELF-CENTERED MANIPULATION</h1>
    <p class="subtitle">Analyzing the algorithmic flow of self-serving influence and validation extraction within networked communities.</p>

    <div id="flowchart-container">
        <!-- SVG for arrows -->
        <svg class="arrows" xmlns="http://www.w3.org/2000/svg">
            <defs>
                <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                    <polygon points="0 0, 10 3.5, 0 7" class="arrowhead-polygon" style="fill:var(--text-medium);" />
                </marker>
            </defs>
            <!-- Top row horizontal arrows -->
            <line id="arrow-1-2" class="flow-arrow" x1="280" y1="105" x2="320" y2="105" />
            <line id="arrow-2-3" class="flow-arrow" x1="570" y1="105" x2="610" y2="105" />
            
            <!-- Mid row horizontal arrows -->
            <line id="arrow-4-5" class="flow-arrow" x1="280" y1="335" x2="320" y2="335" />
            <line id="arrow-5-6" class="flow-arrow" x1="570" y1="335" x2="610" y2="335" />

            <!-- Bottom row horizontal arrows -->
            <line id="arrow-7-8" class="flow-arrow" x1="280" y1="565" x2="320" y2="565" />
            <line id="arrow-8-9" class="flow-arrow" x1="570" y1="565" x2="610" y2="565" />

            <!-- Vertical arrows (connecting main column flow) -->
            <line id="arrow-3-6" class="flow-arrow" x1="735" y1="180" x2="735" y2="260" />
            <line id="arrow-6-9" class="flow-arrow" x1="735" y1="410" x2="735" y2="490" />
        </svg>

        <!-- Flowchart Boxes -->
        <div id="box-1" class="flow-box">
            <div class="box-icon">
                <svg viewBox="0 0 100 100">
                    <rect x="25" y="10" width="50" height="80" rx="5" fill="#3a3a5a" class="stroke-element"/>
                    <rect id="mirror-surface" x="30" y="15" width="40" height="70" rx="3" fill="var(--glow-blue)"/>
                    <circle cx="50" cy="50" r="10" fill="#2a2a4a"/>
                    <path d="M40 80 L60 80 L55 90 L45 90 Z" fill="#3a3a5a"/>
                </svg>
            </div>
            <div class="box-text">IDENTIFY SUPPLY SOURCES</div>
        </div>

        <div id="box-2" class="flow-box">
            <div class="box-icon">
                <svg viewBox="0 0 100 100">
                    <path d="M50 80 C20 80, 5 50, 50 20 C95 50, 80 80, 50 80 Z" class="stroke-element" />
                    <circle cx="50" cy="50" r="15" fill="#2a2a4a" />
                    <path id="thought-bubble-self" d="M60 20 C60 10, 70 5, 80 5 C90 5, 90 15, 80 25 C75 25, 70 20, 65 15 C63 15, 60 15, 60 20 Z" fill="var(--glow-blue)" opacity="0" />
                </svg>
            </div>
            <div class="box-text">EVALUATE UTILITY</div>
            <div class="small-text">[SELF-BENEFIT ALGORITHM]</div>
        </div>

        <div id="box-3" class="flow-box">
            <div class="box-icon">
                <svg viewBox="0 0 100 100">
                    <circle cx="50" cy="50" r="30" fill="#2a2a4a"/>
                    <path id="face-outline" d="M50 20 A30 30 0 0 1 50 80 A30 30 0 0 1 50 20 M35 40 Q45 35 50 40 Q55 35 65 40 M40 60 Q50 65 60 60" fill="none" class="stroke-element" stroke-width="2"/>
                    <path d="M35 40 Q45 35 50 40 Q55 35 65 40 M40 60 Q50 65 60 60" fill="none" stroke="#6a6a8a" stroke-width="1"/>
                </svg>
            </div>
            <div class="box-text">CURATE IDEAL SELF-IMAGE</div>
        </div>

        <div id="box-4" class="flow-box">
            <div class="box-icon">
                <svg viewBox="0 0 100 100">
                    <rect x="10" y="70" width="80" height="20" rx="5" fill="#3a3a5a"/>
                    <path id="spotlight-beam" d="M50 0 L20 70 L80 70 Z" fill="var(--glow-blue)" opacity="0"/>
                    <circle cx="50" cy="80" r="15" id="spotlight-figure"/>
                    <path d="M40 70 L60 70 L55 90 L45 90 Z" />
                    <circle cx="50" cy="5" r="5" fill="var(--glow-red)"/>
                </svg>
            </div>
            <div class="box-text">CRAFT INITIAL APPEAL</div>
            <div class="small-text">[EGO PROJECTION]</div>
        </div>

        <div id="box-5" class="flow-box">
            <div class="box-icon">
                <svg viewBox="0 0 100 100">
                    <rect x="20" y="20" width="60" height="60" rx="5" fill="#3a3a5a"/>
                    <line x1="25" y1="25" x2="75" y2="75" class="stroke-element"/>
                    <line x1="25" y1="75" x2="75" y2="25" class="stroke-element"/>
                    <path id="like-heart" d="M50 30 L40 20 A10 10 0 0 0 30 30 A10 10 0 0 0 50 50 A10 10 0 0 0 70 30 A10 10 0 0 0 60 20 Z" fill="var(--glow-red)"/>
                    <text id="like-count-display" x="50" y="65" font-size="16" text-anchor="middle" fill="var(--glow-blue)" opacity="0">99+</text>
                </svg>
            </div>
            <div class="box-text">REFINE ATTRACTION TACTICS</div>
            <div class="small-text">[OPTIMIZING ENGAGEMENT]</div>
        </div>

        <div id="box-6" class="flow-box">
            <div class="box-icon">
                <svg viewBox="0 0 100 100">
                    <rect x="40" y="60" width="20" height="30" fill="#3a3a5a"/>
                    <circle cx="50" cy="50" r="20"/>
                    <path id="charisma-wave-1" d="M50 50 L10 50 C10 20, 90 20, 90 50 L50 50 Z" fill="none" class="stroke-element" stroke-width="3" opacity="0"/>
                    <path id="charisma-wave-2" d="M50 50 L20 50 C20 30, 80 30, 80 50 L50 50 Z" fill="none" class="stroke-element" stroke-width="3" opacity="0"/>
                </svg>
            </div>
            <div class="box-text">PROJECT SELF-IMAGE</div>
            <div class="small-text">[CHARISMA BROADCAST]</div>
        </div>

        <div id="box-7" class="flow-box">
            <div class="box-icon">
                <svg viewBox="0 0 100 100">
                    <circle cx="50" cy="50" r="20"/>
                    <path d="M50 70 L20 85 L80 85 L50 70 Z" fill="#3a3a5a"/>
                    <circle id="orb-1" cx="30" cy="30" r="5" fill="var(--glow-blue)" opacity="0"/>
                    <circle id="orb-2" cx="70" cy="30" r="5" fill="var(--glow-red)" opacity="0"/>
                    <circle id="orb-3" cx="50" cy="15" r="5" fill="var(--glow-purple)" opacity="0"/>
                </svg>
            </div>
            <div class="box-text">EXTRACT VALIDATION/RESOURCES</div>
        </div>

        <div id="box-8" class="flow-box">
            <div class="box-icon">
                <svg viewBox="0 0 100 100">
                    <circle cx="50" cy="50" r="20" id="manipulator-figure"/>
                    <path d="M50 70 L20 85 L80 85 L50 70 Z" fill="#3a3a5a"/>
                    <path id="crown-element" d="M40 25 L30 35 L40 30 L50 20 L60 30 L70 35 L60 25 Z" fill="var(--glow-blue)"/>
                </svg>
            </div>
            <div class="box-text">LEVERAGE SUPPLY FOR SELF-GAIN</div>
            <div class="small-text">[STATUS UPGRADE]</div>
        </div>

        <div id="box-9" class="flow-box">
            <div class="box-icon">
                <svg viewBox="0 0 100 100">
                    <rect x="20" y="40" width="60" height="30" rx="3" fill="#3a3a5a"/>
                    <path id="cracked-surface" d="M25 45 L75 65 M25 65 L75 45 M50 40 L50 70" fill="none" class="stroke-element" stroke-width="2" opacity="0"/>
                    <circle id="new-source-orb" cx="85" cy="20" r="10" fill="var(--glow-green)" opacity="0"/>
                    <path d="M50 50 L20 85 L80 85 L50 50 Z" fill="#2a2a4a"/>
                    <circle cx="50" cy="30" r="15" fill="#2a2a4a"/>
                </svg>
            </div>
            <div class="box-text">DISCARD & SEEK NEW SUPPLY</div>
        </div>
    </div>

    <div class="controls">
        <button id="prevBtn" disabled>PREVIOUS STEP</button>
        <button id="nextBtn">NEXT STEP</button>
        <p id="currentStepText">STEP <span id="currentStepNumber">0</span> OF <span id="totalStepsNumber"></span></p>
    </div>
    <div id="phase-explanation">
        <span id="phase-description-text">INITIATE 'NARCISSUS PROTOCOL' SEQUENCE.</span>
    </div>

    <script>
        const flowchartBoxes = [
            null, // Step 0 is just initial state, no box highlighted
            { id: 'box-1', arrow: null, description: 'Step 1: IDENTIFY SUPPLY SOURCES - The manipulator scans for individuals or groups capable of providing attention, resources, or validation to feed their ego.' },
            { id: 'box-2', arrow: 'arrow-1-2', description: 'Step 2: EVALUATE UTILITY - Potential sources are assessed purely on their capacity to serve the manipulator\'s needs. Vulnerabilities and desires of others are analyzed for self-benefit. [SELF-BENEFIT ALGORITHM]' },
            { id: 'box-3', arrow: 'arrow-2-3', description: 'Step 3: CURATE IDEAL SELF-IMAGE - A flawless, often exaggerated or fabricated, persona is meticulously constructed. This idealized self is designed to be irresistible and to attract maximum adoration.' },
            { id: 'box-4', arrow: 'arrow-3-6', description: 'Step 4: CRAFT INITIAL APPEAL - The manipulator designs initial interactions to captivate and draw targets into their orbit, often by feigning interest or creating an aura of exclusivity. [EGO PROJECTION]' },
            { id: 'box-5', arrow: 'arrow-4-5', description: 'Step 5: REFINE ATTRACTION TACTICS - Engagement strategies are constantly optimized based on feedback (likes, praise, favors). Tactics are adjusted to ensure a steady flow of attention and resources. [OPTIMIZING ENGAGEMENT]' },
            { id: 'box-6', arrow: 'arrow-5-6', description: 'Step 6: PROJECT SELF-IMAGE - The curated persona is broadcast and maintained consistently across all interactions, ensuring the manipulator remains the focal point and object of admiration. [CHARISMA BROADCAST]' },
            { id: 'box-7', arrow: 'arrow-6-9', description: 'Step 7: EXTRACT VALIDATION/RESOURCES - The manipulator actively siphons off validation, emotional energy, material resources, or favors from their captivated audience, converting it directly into self-enrichment.' },
            { id: 'box-8', arrow: 'arrow-7-8', description: 'Step 8: LEVERAGE SUPPLY FOR SELF-GAIN - Accumulated attention and resources are used to further elevate the manipulator\'s status, image, or perceived power, creating a feedback loop for greater supply. [STATUS UPGRADE]' },
            { id: 'box-9', arrow: 'arrow-8-9', description: 'Step 9: DISCARD & SEEK NEW SUPPLY - Once a source is depleted, no longer useful, or begins to question the manipulator, they are ruthlessly discarded as the manipulator moves on to cultivate fresh targets. [NARCISSISTIC CYCLE REBOOT]' },
        ];

        let currentStep = 0;
        const totalSteps = flowchartBoxes.length - 1;

        const nextBtn = document.getElementById('nextBtn');
        const prevBtn = document.getElementById('prevBtn');
        const phaseExplanation = document.getElementById('phase-description-text');
        const currentStepNumber = document.getElementById('currentStepNumber');
        const totalStepsNumber = document.getElementById('totalStepsNumber');
        const arrowheadPolygon = document.querySelector('#arrowhead .arrowhead-polygon');

        totalStepsNumber.textContent = totalSteps;

        // Function to reset all animations
        function resetAnimations() {
            document.querySelectorAll('.box-icon svg *').forEach(el => {
                el.style.animation = ''; // Clear animation property
                el.style.filter = ''; // Clear filter for glow
                el.style.transform = ''; // Clear any direct transforms
                el.style.opacity = el.getAttribute('data-initial-opacity') || ''; // Reset specific opacities
                if (el.classList.contains('stroke-element')) {
                    el.style.stroke = 'var(--text-medium)';
                } else {
                    // For fills, only reset if it's not a background element that should stay muted
                    // More precise control is needed for specific elements if their default fill is not --text-medium
                    // For now, let's reset to the generic text color for active elements, backgrounds often have specific fills.
                    // This relies on the SVG paths having fill:var(--text-medium) by default or being explicitly set.
                    // For the more complex SVGs here, direct fills are often used, so we need to be careful.
                    // A better approach for fills might be to store default fills.
                }
            });

            // Specific resets for elements whose opacity is controlled via JS to enable/disable animations
            document.getElementById('mirror-surface').style.opacity = 0.7; // Restore default partial opacity
            document.getElementById('thought-bubble-self').style.opacity = 0;
            document.getElementById('face-outline').style.opacity = 0;
            document.getElementById('face-outline').style.strokeDasharray = '0 100';
            document.getElementById('spotlight-beam').style.opacity = 0;
            document.getElementById('like-count-display').style.opacity = 0;
            document.getElementById('charisma-wave-1').style.opacity = 0;
            document.getElementById('charisma-wave-2').style.opacity = 0;
            document.getElementById('orb-1').style.opacity = 0;
            document.getElementById('orb-2').style.opacity = 0;
            document.getElementById('orb-3').style.opacity = 0;
            document.getElementById('cracked-surface').style.opacity = 0;
            document.getElementById('cracked-surface').style.strokeDasharray = '0 100';
            document.getElementById('new-source-orb').style.opacity = 0;
        }

        function updateFlowchart() {
            // Remove highlight from all boxes and arrows first
            document.querySelectorAll('.flow-box').forEach(box => box.classList.remove('highlight'));
            document.querySelectorAll('.flow-arrow').forEach(arrow => {
                arrow.classList.remove('highlight');
                arrow.style.stroke = 'var(--text-medium)';
            });
            // Reset arrowhead color
            arrowheadPolygon.style.fill = 'var(--text-medium)';

            // Reset all icon animations
            resetAnimations();

            currentStepNumber.textContent = currentStep;

            if (currentStep === 0) {
                phaseExplanation.textContent = 'INITIATE \'NARCISSUS PROTOCOL\' SEQUENCE.';
            } else {
                const currentPhase = flowchartBoxes[currentStep];
                // Highlight the current box
                const currentBox = document.getElementById(currentPhase.id);
                currentBox.classList.add('highlight');
                
                // Highlight the arrow *leading to* this step (if defined)
                if (currentPhase.arrow) {
                    const arrowElement = document.getElementById(currentPhase.arrow);
                    arrowElement.classList.add('highlight');
                    arrowElement.style.stroke = 'var(--glow-red)'; // Set arrow color
                    arrowheadPolygon.style.fill = 'var(--glow-red)'; // Set arrowhead color
                }
                phaseExplanation.textContent = currentPhase.description;

                // Trigger specific animations for the highlighted box's icon
                switch(currentPhase.id) {
                    case 'box-1':
                        // Animation tied to class, not direct style
                        break;
                    case 'box-2':
                        document.getElementById('thought-bubble-self').style.opacity = 1;
                        break;
                    case 'box-3':
                        document.getElementById('face-outline').style.opacity = 1;
                        break;
                    case 'box-4':
                        document.getElementById('spotlight-beam').style.opacity = 1;
                        break;
                    case 'box-5':
                        document.getElementById('like-count-display').style.opacity = 1;
                        break;
                    case 'box-6':
                        document.getElementById('charisma-wave-1').style.opacity = 1;
                        document.getElementById('charisma-wave-2').style.opacity = 1;
                        break;
                    case 'box-7':
                        document.getElementById('orb-1').style.opacity = 1;
                        document.getElementById('orb-2').style.opacity = 1;
                        document.getElementById('orb-3').style.opacity = 1;
                        break;
                    case 'box-8':
                        // Animations tied to class, not direct style
                        break;
                    case 'box-9':
                        document.getElementById('cracked-surface').style.opacity = 1;
                        document.getElementById('new-source-orb').style.opacity = 1;
                        break;
                }
            }

            // Update button states
            prevBtn.disabled = currentStep === 0;
            nextBtn.disabled = currentStep === totalSteps;
        }

        nextBtn.addEventListener('click', () => {
            if (currentStep < totalSteps) {
                currentStep++;
                updateFlowchart();
            }
        });

        prevBtn.addEventListener('click', () => {
            if (currentStep > 0) {
                currentStep--;
                updateFlowchart();
            }
        });

        // Store initial opacities for elements that start hidden
        document.addEventListener('DOMContentLoaded', () => {
            // Note: Data-initial-opacity isn't strictly needed if we manage initial states and resets carefully.
            // For elements that are animated by default *only when highlighted*, their default state in CSS should be hidden/transparent.
            updateFlowchart();
        });
    </script>
</body>
</html>
