<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pathological Liar Protocol: The Deceptive Flow</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Share+Tech+Mono&display=swap');

        :root {
            --bg-dark: #1a1a2e;
            --bg-medium: #2a2a4a;
            --text-light: #e0e0e0;
            --text-medium: #a0a0c0;
            --accent-blue: #00bcd4; /* Cyan */
            --accent-purple: #8e44ad;
            --accent-green: #2ecc71;
            --highlight-red: #e74c3c; /* Still a strong red for danger/manipulation */
            --glow-red: #ff0055;
            --glow-blue: #00ffff; /* Neon Blue */
            --glow-purple: #ff00ff; /* Magenta */
            --border-color: #3f3f5a;
            --box-bg-normal: #333355;
            --box-bg-highlight: #444466;
        }

        body {
            font-family: 'Share Tech Mono', monospace, Arial, sans-serif; /* Futuristic font */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            min-height: 100vh;
            margin: 0;
            background-color: var(--bg-dark);
            color: var(--text-light);
            padding: 20px;
            box-sizing: border-box;
            overflow-x: hidden; /* Prevent horizontal scroll */
        }
        h1 {
            font-family: 'Orbitron', sans-serif; /* More impactful font for title */
            color: var(--glow-blue);
            text-shadow: 0 0 10px var(--glow-blue), 0 0 20px var(--glow-blue);
            margin-bottom: 15px;
            text-align: center;
            letter-spacing: 2px;
        }
        p.subtitle {
            font-size: 0.9em;
            color: var(--text-medium);
            margin-bottom: 30px;
            text-align: center;
            max-width: 800px;
        }
        #flowchart-container {
            position: relative;
            width: 900px;
            height: 750px;
            border: 1px solid var(--border-color);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.2); /* Subtle blue glow */
            background-color: var(--bg-medium);
            padding: 20px;
            border-radius: 8px;
            box-sizing: border-box;
            display: flex;
            justify-content: center;
            align-items: center;
            perspective: 1000px; /* For 3D transforms */
        }
        .flow-box {
            position: absolute;
            width: 250px;
            height: 150px;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            font-size: 0.9em;
            color: var(--text-light);
            box-sizing: border-box;
            transition: all 0.4s ease-in-out, box-shadow 0.6s ease-in-out;
            border: 2px solid var(--border-color);
            background-color: var(--box-bg-normal);
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5); /* Inner shadow for depth */
            z-index: 1;
            transform-style: preserve-3d; /* For child transforms */
        }
        .flow-box.highlight {
            border-color: var(--glow-red);
            box-shadow: 0 0 15px var(--glow-red), 0 0 30px rgba(255, 0, 85, 0.4); /* Stronger glow */
            transform: scale(1.05) rotateY(5deg); /* Slight 3D tilt */
            z-index: 10;
            background-color: var(--box-bg-highlight);
        }

        /* Positioning - unchanged */
        #box-1 { top: 30px; left: 30px; }
        #box-2 { top: 30px; left: 320px; }
        #box-3 { top: 30px; left: 610px; }
        #box-4 { top: 260px; left: 30px; }
        #box-5 { top: 260px; left: 320px; }
        #box-6 { top: 260px; left: 610px; }
        #box-7 { top: 490px; left: 30px; }
        #box-8 { top: 490px; left: 320px; }
        #box-9 { top: 490px; left: 610px; }

        /* SVG Arrows */
        svg.arrows {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: 0;
        }
        .flow-arrow {
            stroke: var(--text-medium);
            stroke-width: 2;
            fill: none;
            marker-end: url(#arrowhead);
            transition: stroke 0.4s ease-in-out, stroke-width 0.4s ease-in-out, opacity 0.4s ease-in-out;
            opacity: 0.5; /* Always slightly visible but muted */
        }
        .flow-arrow.highlight {
            stroke: var(--glow-red);
            stroke-width: 4;
            opacity: 1;
            z-index: 5;
            filter: drop-shadow(0 0 5px var(--glow-red)); /* Glow for arrows */
        }
        #arrowhead polygon { fill: var(--text-medium); transition: fill 0.4s ease-in-out; }

        /* Icons inside boxes */
        .box-icon {
            margin-bottom: 5px;
            height: 60px; /* Slightly larger icons */
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }
        .box-icon svg {
            height: 100%;
            width: auto;
            max-width: 80%;
        }
        .box-icon svg path, .box-icon svg circle, .box-icon svg rect, .box-icon svg polygon, .box-icon svg line {
            fill: var(--text-medium);
            stroke: none;
            transition: fill 0.4s ease-in-out, stroke 0.4s ease-in-out;
            transform-origin: center center;
            vector-effect: non-scaling-stroke; /* Keep stroke width consistent on zoom */
        }
        .box-icon svg .stroke-element {
            stroke: var(--text-medium);
            stroke-width: 2px;
            fill: none;
            transition: stroke 0.4s ease-in-out;
        }
        
        .box-text, .small-text {
            font-weight: bold;
            margin-top: 5px;
            transition: color 0.4s ease-in-out;
            letter-spacing: 0.5px;
        }
        .small-text {
            font-size: 0.8em;
            color: var(--text-medium);
            font-weight: normal;
        }

        /* Highlight styles for contents of the highlighted box */
        .flow-box.highlight .box-icon svg path,
        .flow-box.highlight .box-icon svg circle,
        .flow-box.highlight .box-icon svg rect,
        .flow-box.highlight .box-icon svg polygon,
        .flow-box.highlight .box-icon svg line {
            fill: var(--glow-blue); /* Glowing blue for icons */
        }
        .flow-box.highlight .box-icon svg .stroke-element {
            stroke: var(--glow-blue);
        }
        .flow-box.highlight .box-text {
            color: var(--glow-blue);
            text-shadow: 0 0 5px var(--glow-blue);
        }
        .flow-box.highlight .small-text {
            color: var(--accent-blue);
        }

        /* ANIMATIONS */
        /* Reset all animations for elements not highlighted */
        .box-icon svg * { animation: none !important; }

        /* 1. Identify Target Audience: Distorted mirror shimmer */
        @keyframes distortShimmer {
            0%, 100% { transform: skewX(0deg); opacity: 0.7; }
            50% { transform: skewX(5deg); opacity: 1; }
        }
        @keyframes figureShift {
            0%, 100% { transform: translateX(0); }
            50% { transform: translateX(2px); }
        }
        .flow-box.highlight #distorted-mirror-surface {
            animation: distortShimmer 2s ease-in-out infinite alternate;
        }
        .flow-box.highlight #mirror-figure {
            animation: figureShift 1.5s ease-in-out infinite alternate;
        }
        #distorted-mirror-surface { opacity: 0.7; }

        /* 2. Fabricate Core Lie: Tangled lie glow */
        @keyframes lieGlow {
            0%, 100% { filter: drop-shadow(0 0 2px var(--glow-blue)); }
            50% { filter: drop-shadow(0 0 5px var(--glow-blue)); }
        }
        @keyframes liePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.03); }
        }
        .flow-box.highlight #tangled-lie {
            animation: lieGlow 1.5s ease-in-out infinite alternate, liePulse 1.5s ease-in-out infinite alternate;
        }

        /* 3. Construct False Persona: Mask reveal */
        @keyframes maskReveal {
            0% { transform: scaleX(0); opacity: 0; }
            100% { transform: scaleX(1); opacity: 1; }
        }
        @keyframes maskGlow {
            0%, 100% { filter: drop-shadow(0 0 3px var(--glow-blue)); }
            50% { filter: drop-shadow(0 0 7px var(--glow-blue)); }
        }
        .flow-box.highlight #false-mask {
            animation: maskReveal 1s ease-out forwards, maskGlow 2s ease-in-out infinite alternate 1s;
        }
        #false-mask { transform: scaleX(0); opacity: 0; }

        /* 4. Weave Initial Deception: Web pulse */
        @keyframes webPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        @keyframes webGlow {
            0%, 100% { filter: drop-shadow(0 0 2px var(--glow-blue)); }
            50% { filter: drop-shadow(0 0 5px var(--glow-blue)); }
        }
        .flow-box.highlight #spider-web {
            animation: webPulse 1.5s ease-in-out infinite alternate, webGlow 1.5s ease-in-out infinite alternate;
        }

        /* 5. Reinforce & Adapt Lies: Rewriting text */
        @keyframes rewriteText {
            0% { opacity: 0; transform: translateY(5px); }
            50% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-5px); }
        }
        @keyframes penWiggle {
            0%, 100% { transform: rotate(0deg); }
            50% { transform: rotate(5deg); }
        }
        .flow-box.highlight #rewriting-text {
            animation: rewriteText 2s ease-in-out infinite;
        }
        .flow-box.highlight #liar-pen {
            animation: penWiggle 1s ease-in-out infinite alternate;
        }
        #rewriting-text { opacity: 0; }

        /* 6. Disseminate Falsehood: Distorted speaker waves */
        @keyframes distortedWave {
            0% { transform: scaleX(0.1) translateY(0); opacity: 0; }
            20% { transform: scaleX(0.5) translateY(-5px); opacity: 1; }
            80% { transform: scaleX(1.2) translateY(5px); opacity: 0; }
            100% { transform: scaleX(1.5) translateY(0); opacity: 0; }
        }
        .flow-box.highlight #distorted-wave-1 { animation: distortedWave 2s ease-out infinite; }
        .flow-box.highlight #distorted-wave-2 { animation: distortedWave 2s 0.3s ease-out infinite; }
        .flow-box.highlight #distorted-wave-3 { animation: distortedWave 2s 0.6s ease-out infinite; }
        #distorted-wave-1, #distorted-wave-2, #distorted-wave-3 { opacity: 0; }

        /* 7. Gain Trust/Sympathy: Hollow heart beat */
        @keyframes heartBeat {
            0%, 100% { transform: scale(1); filter: drop-shadow(0 0 3px var(--glow-red)); }
            50% { transform: scale(1.1); filter: drop-shadow(0 0 7px var(--glow-red)); }
        }
        .flow-box.highlight #hollow-heart {
            animation: heartBeat 1.2s ease-in-out infinite;
        }

        /* 8. Reinforce Illusion: House of cards wobble */
        @keyframes houseWobble {
            0%, 100% { transform: translateX(0) rotate(0deg); }
            25% { transform: translateX(2px) rotate(1deg); }
            75% { transform: translateX(-2px) rotate(-1deg); }
        }
        @keyframes houseGlow {
            0%, 100% { filter: drop-shadow(0 0 3px var(--glow-blue)); }
            50% { filter: drop-shadow(0 0 6px var(--glow-blue)); }
        }
        .flow-box.highlight #house-of-cards {
            animation: houseWobble 1.5s ease-in-out infinite alternate, houseGlow 2s ease-in-out infinite alternate;
        }

        /* 9. Discard & Re-engage: Shattered mirror, new reflection */
        @keyframes mirrorShatter {
            0% { opacity: 1; }
            50% { opacity: 1; transform: scale(1.05); }
            100% { opacity: 0; transform: scale(0.8) rotate(10deg); }
        }
        @keyframes newReflectionAppear {
            0% { opacity: 0; transform: scale(0.5) translateY(10px); }
            100% { opacity: 1; transform: scale(1) translateY(0); }
        }
        .flow-box.highlight #shattered-mirror {
            animation: mirrorShatter 1.5s ease-out forwards;
        }
        .flow-box.highlight #new-reflection {
            animation: newReflectionAppear 1s ease-out forwards 1s;
        }
        #shattered-mirror { opacity: 1; }
        #new-reflection { opacity: 0; }


        /* Controls */
        .controls {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-top: 30px;
            font-size: 1.1em;
            background-color: var(--bg-medium);
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.2);
        }
        button {
            padding: 12px 25px;
            font-size: 1em;
            cursor: pointer;
            border: none;
            border-radius: 6px;
            background-color: var(--accent-blue);
            color: var(--bg-dark);
            font-weight: bold;
            transition: background-color 0.2s ease-in-out, transform 0.1s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        button:hover:not(:disabled) {
            background-color: var(--glow-blue);
            transform: translateY(-1px);
            box-shadow: 0 0 8px var(--glow-blue);
        }
        button:active:not(:disabled) {
            transform: translateY(0);
        }
        button:disabled {
            background-color: var(--border-color);
            color: var(--text-medium);
            cursor: not-allowed;
            box-shadow: none;
        }
        #currentStepText {
            color: var(--text-light);
        }
        #phase-explanation {
            margin-top: 20px;
            width: 80%;
            max-width: 800px;
            padding: 15px;
            background-color: var(--bg-medium);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            text-align: center;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 15px rgba(255, 0, 85, 0.2); /* Red glow for explanations */
            font-size: 1em;
            color: var(--text-light);
        }
        #phase-description-text {
            font-weight: bold;
            color: var(--glow-red);
        }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
</head>
<body>
    <h1>PATHOLOGICAL LIAR PROTOCOL: THE DECEPTIVE FLOW</h1>
    <p class="subtitle">Deconstructing the algorithmic construction and maintenance of an illusory reality for personal gain.</p>

    <div id="flowchart-container">
        <!-- SVG for arrows -->
        <svg class="arrows" xmlns="http://www.w3.org/2000/svg">
            <defs>
                <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                    <polygon points="0 0, 10 3.5, 0 7" class="arrowhead-polygon" style="fill:var(--text-medium);" />
                </marker>
            </defs>
            <!-- Top row horizontal arrows -->
            <line id="arrow-1-2" class="flow-arrow" x1="280" y1="105" x2="320" y2="105" />
            <line id="arrow-2-3" class="flow-arrow" x1="570" y1="105" x2="610" y2="105" />
            
            <!-- Mid row horizontal arrows -->
            <line id="arrow-4-5" class="flow-arrow" x1="280" y1="335" x2="320" y2="335" />
            <line id="arrow-5-6" class="flow-arrow" x1="570" y1="335" x2="610" y2="335" />

            <!-- Bottom row horizontal arrows -->
            <line id="arrow-7-8" class="flow-arrow" x1="280" y1="565" x2="320" y2="565" />
            <line id="arrow-8-9" class="flow-arrow" x1="570" y1="565" x2="610" y2="565" />

            <!-- Vertical arrows (connecting main column flow) -->
            <line id="arrow-3-6" class="flow-arrow" x1="735" y1="180" x2="735" y2="260" />
            <line id="arrow-6-9" class="flow-arrow" x1="735" y1="410" x2="735" y2="490" />
        </svg>

        <!-- Flowchart Boxes -->
        <div id="box-1" class="flow-box">
            <div class="box-icon">
                <svg viewBox="0 0 100 100">
                    <rect x="20" y="10" width="60" height="80" rx="5" fill="#3a3a5a" class="stroke-element"/>
                    <g id="distorted-mirror-surface">
                        <path d="M25 15 L75 15 L70 85 L30 85 Z" fill="var(--glow-blue)"/>
                        <path d="M30 20 L70 20 L65 80 L35 80 Z" fill="#2a2a4a"/>
                        <path id="mirror-figure" d="M45 40 Q50 30 55 40 Q60 50 55 60 Q50 70 45 60 Q40 50 45 40 Z" fill="#5a5a7a"/>
                    </g>
                </svg>
            </div>
            <div class="box-text">IDENTIFY TARGET AUDIENCE</div>
        </div>

        <div id="box-2" class="flow-box">
            <div class="box-icon">
                <svg viewBox="0 0 100 100">
                    <circle cx="50" cy="50" r="40" class="stroke-element"/>
                    <text x="50" y="30" font-size="10" text-anchor="middle" fill="#ccc">TRUTH: FALSE</text>
                    <path id="tangled-lie" d="M30 40 Q50 20 70 40 Q50 80 30 60 Q70 60 50 40 Z" fill="none" class="stroke-element" stroke-width="2"/>
                    <text x="50" y="70" font-size="10" text-anchor="middle" fill="#ccc">BENEFIT: HIGH</text>
                </svg>
            </div>
            <div class="box-text">FABRICATE CORE LIE</div>
            <div class="small-text">[SELF-SERVING NARRATIVE]</div>
        </div>

        <div id="box-3" class="flow-box">
            <div class="box-icon">
                <svg viewBox="0 0 100 100">
                    <circle cx="50" cy="50" r="35" class="stroke-element" fill="#2a2a4a"/>
                    <path id="false-mask" d="M30 30 C30 20, 70 20, 70 30 C70 40, 60 50, 50 50 C40 50, 30 40, 30 30 Z M40 55 C40 60, 60 60, 60 55 C60 50, 40 50, 40 55 Z" fill="#5a5a7a" class="stroke-element"/>
                </svg>
            </div>
            <div class="box-text">CONSTRUCT FALSE PERSONA</div>
        </div>

        <div id="box-4" class="flow-box">
            <div class="box-icon">
                <svg viewBox="0 0 100 100">
                    <circle cx="50" cy="50" r="40" class="stroke-element" fill="#3a3a5a"/>
                    <g id="spider-web" class="stroke-element">
                        <line x1="50" y1="10" x2="50" y2="90"/>
                        <line x1="10" y1="50" x2="90" y2="50"/>
                        <line x1="22" y1="22" x2="78" y2="78"/>
                        <line x1="22" y1="78" x2="78" y2="22"/>
                        <circle cx="50" cy="50" r="10" fill="var(--glow-blue)"/>
                    </g>
                </svg>
            </div>
            <div class="box-text">WEAVE INITIAL DECEPTION</div>
            <div class="small-text">[ENTANGLEMENT PROTOCOL]</div>
        </div>

        <div id="box-5" class="flow-box">
            <div class="box-icon">
                <svg viewBox="0 0 100 100">
                    <rect x="15" y="40" width="70" height="30" fill="#3a3a5a" rx="5"/>
                    <path id="liar-pen" d="M75 35 L70 30 L60 40 L65 45 L75 35 Z" fill="#5a5a7a" class="stroke-element"/>
                    <text id="rewriting-text" x="50" y="58" font-size="12" text-anchor="middle" fill="var(--glow-blue)">REVISION 4.2</text>
                </svg>
            </div>
            <div class="box-text">REINFORCE & ADAPT LIES</div>
            <div class="small-text">[DYNAMIC FABRICATION]</div>
        </div>

        <div id="box-6" class="flow-box">
            <div class="box-icon">
                <svg viewBox="0 0 100 100">
                    <rect x="25" y="40" width="50" height="30" fill="#3a3a5a" rx="5"/>
                    <path d="M20 55 L25 40 L25 70 Z" fill="#3a3a5a"/>
                    <path id="distorted-wave-1" d="M75 55 Q85 45 85 55 Q85 65 75 55 Z" fill="none" class="stroke-element" stroke-width="2" opacity="0"/>
                    <path id="distorted-wave-2" d="M80 55 Q90 40 90 55 Q90 70 80 55 Z" fill="none" class="stroke-element" stroke-width="2" opacity="0"/>
                    <path id="distorted-wave-3" d="M85 55 Q95 35 95 55 Q95 75 85 55 Z" fill="none" class="stroke-element" stroke-width="2" opacity="0"/>
                </svg>
            </div>
            <div class="box-text">DISSEMINATE FALSEHOODS</div>
            <div class="small-text">[ILLUSION BROADCAST]</div>
        </div>

        <div id="box-7" class="flow-box">
            <div class="box-icon">
                <svg viewBox="0 0 100 100">
                    <path id="hollow-heart" d="M50 30 C 70 10, 90 40, 50 90 C 10 40, 30 10, 50 30 Z" fill="none" class="stroke-element" stroke-width="3"/>
                    <circle cx="50" cy="50" r="15" fill="#2a2a4a"/>
                </svg>
            </div>
            <div class="box-text">GAIN TRUST & SYMPATHY</div>
        </div>

        <div id="box-8" class="flow-box">
            <div class="box-icon">
                <svg viewBox="0 0 100 100">
                    <g id="house-of-cards">
                        <rect x="30" y="70" width="40" height="20" rx="2" fill="#3a3a5a"/>
                        <rect x="35" y="50" width="30" height="20" rx="2" fill="#3a3a5a"/>
                        <rect x="40" y="30" width="20" height="20" rx="2" fill="#3a3a5a"/>
                        <path d="M45 10 L55 10 L50 20 Z" fill="#3a3a5a"/>
                    </g>
                </svg>
            </div>
            <div class="box-text">REINFORCE ILLUSION</div>
            <div class="small-text">[FABRICATED REALITY]</div>
        </div>

        <div id="box-9" class="flow-box">
            <div class="box-icon">
                <svg viewBox="0 0 100 100">
                    <rect x="20" y="10" width="60" height="80" rx="5" fill="#3a3a5a" class="stroke-element"/>
                    <g id="shattered-mirror">
                        <line x1="30" y1="20" x2="70" y2="80" class="stroke-element"/>
                        <line x1="30" y1="80" x2="70" y2="20" class="stroke-element"/>
                        <line x1="50" y1="15" x2="50" y2="85" class="stroke-element"/>
                        <circle cx="50" cy="50" r="10" fill="#2a2a4a"/>
                    </g>
                    <g id="new-reflection" opacity="0">
                        <path d="M70 15 L90 15 L85 25 L75 25 Z" fill="#5a5a7a"/>
                        <circle cx="80" cy="15" r="5" fill="var(--glow-green)"/>
                    </g>
                </svg>
            </div>
            <div class="box-text">DISCARD & RE-ENGAGE</div>
        </div>
    </div>

    <div class="controls">
        <button id="prevBtn" disabled>PREVIOUS STEP</button>
        <button id="nextBtn">NEXT STEP</button>
        <p id="currentStepText">STEP <span id="currentStepNumber">0</span> OF <span id="totalStepsNumber"></span></p>
    </div>
    <div id="phase-explanation">
        <span id="phase-description-text">INITIATE 'PATHOLOGICAL LIAR PROTOCOL' SEQUENCE.</span>
    </div>

    <script>
        const flowchartBoxes = [
            null, // Step 0 is just initial state, no box highlighted
            { id: 'box-1', arrow: null, description: 'Step 1: IDENTIFY TARGET AUDIENCE - The liar surveys their social environment, identifying individuals susceptible to their narratives, seeking attention, validation, or material gain.' },
            { id: 'box-2', arrow: 'arrow-1-2', description: 'Step 2: FABRICATE CORE LIE - A central, often elaborate, falsehood is constructed, designed to achieve a specific personal outcome, regardless of truth or consequence. [SELF-SERVING NARRATIVE]' },
            { id: 'box-3', arrow: 'arrow-2-3', description: 'Step 3: CONSTRUCT FALSE PERSONA - An idealized, believable identity is crafted to support the core lie, obscuring the liar\'s true self and intentions.' },
            { id: 'box-4', arrow: 'arrow-3-6', description: 'Step 4: WEAVE INITIAL DECEPTION - The liar initiates contact, deploying subtle falsehoods and charm to draw the target into their fabricated reality, creating a web of trust. [ENTANGLEMENT PROTOCOL]' },
            { id: 'box-5', arrow: 'arrow-4-5', description: 'Step 5: REINFORCE & ADAPT LIES - As interactions progress, the liar continuously generates new supporting lies, adapting their story to maintain consistency and deflect scrutiny. [DYNAMIC FABRICATION]' },
            { id: 'box-6', arrow: 'arrow-5-6', description: 'Step 6: DISSEMINATE FALSEHOODS - The fabricated narrative is actively communicated, often with great conviction and emotional intensity, to solidify its acceptance within the target\'s perception. [ILLUSION BROADCAST]' },
            { id: 'box-7', arrow: 'arrow-6-9', description: 'Step 7: GAIN TRUST & SYMPATHY - Through a sustained effort of deception, the liar cultivates strong emotional bonds, eliciting trust, pity, or admiration from the target to secure their cooperation.' },
            { id: 'box-8', arrow: 'arrow-7-8', description: 'Step 8: REINFORCE ILLUSION - The liar surrounds themselves with elements that support their fabricated reality, creating a fragile but convincing world that can easily collapse under pressure. [FABRICATED REALITY]' },
            { id: 'box-9', arrow: 'arrow-8-9', description: 'Step 9: DISCARD & RE-ENGAGE - When the lie is exposed, the target becomes suspicious, or the liar\'s needs shift, the current facade is abandoned, and a new cycle of deception begins with new targets or narratives.' },
        ];

        let currentStep = 0;
        const totalSteps = flowchartBoxes.length - 1;

        const nextBtn = document.getElementById('nextBtn');
        const prevBtn = document.getElementById('prevBtn');
        const phaseExplanation = document.getElementById('phase-description-text');
        const currentStepNumber = document.getElementById('currentStepNumber');
        const totalStepsNumber = document.getElementById('totalStepsNumber');
        const arrowheadPolygon = document.querySelector('#arrowhead .arrowhead-polygon');

        totalStepsNumber.textContent = totalSteps;

        // Function to reset all animations and dynamic styles
        function resetAnimations() {
            // Remove all animations and filters from all SVG elements
            document.querySelectorAll('.box-icon svg *').forEach(el => {
                el.style.animation = '';
                el.style.filter = '';
                el.style.transform = '';
            });

            // Specific opacity/visibility resets for elements that are hidden by default or fade in
            document.getElementById('distorted-mirror-surface').style.opacity = 0.7; // Default state
            document.getElementById('tangled-lie').style.filter = 'none'; // Clear filter
            document.getElementById('false-mask').style.transform = 'scaleX(0)';
            document.getElementById('false-mask').style.opacity = 0;
            document.getElementById('rewriting-text').style.opacity = 0;
            document.getElementById('distorted-wave-1').style.opacity = 0;
            document.getElementById('distorted-wave-2').style.opacity = 0;
            document.getElementById('distorted-wave-3').style.opacity = 0;
            document.getElementById('hollow-heart').style.filter = 'none'; // Clear filter
            document.getElementById('shattered-mirror').style.opacity = 1; // Default visible
            document.getElementById('shattered-mirror').style.transform = ''; // Clear transform
            document.getElementById('new-reflection').style.opacity = 0;
            document.getElementById('new-reflection').style.transform = '';
        }

        function updateFlowchart() {
            // Remove highlight from all boxes and arrows first
            document.querySelectorAll('.flow-box').forEach(box => box.classList.remove('highlight'));
            document.querySelectorAll('.flow-arrow').forEach(arrow => {
                arrow.classList.remove('highlight');
                arrow.style.stroke = 'var(--text-medium)';
            });
            // Reset arrowhead color
            arrowheadPolygon.style.fill = 'var(--text-medium)';

            // Reset all icon animations before applying new ones
            resetAnimations();

            currentStepNumber.textContent = currentStep;

            if (currentStep === 0) {
                phaseExplanation.textContent = 'INITIATE \'PATHOLOGICAL LIAR PROTOCOL\' SEQUENCE.';
            } else {
                const currentPhase = flowchartBoxes[currentStep];
                // Highlight the current box
                const currentBox = document.getElementById(currentPhase.id);
                currentBox.classList.add('highlight');
                
                // Highlight the arrow *leading to* this step (if defined)
                if (currentPhase.arrow) {
                    const arrowElement = document.getElementById(currentPhase.arrow);
                    arrowElement.classList.add('highlight');
                    arrowElement.style.stroke = 'var(--glow-red)'; // Set arrow color
                    arrowheadPolygon.style.fill = 'var(--glow-red)'; // Set arrowhead color
                }
                phaseExplanation.textContent = currentPhase.description;

                // Trigger specific animations for the highlighted box's icon
                switch(currentPhase.id) {
                    case 'box-1':
                        // Animations controlled by CSS class highlight
                        break;
                    case 'box-2':
                        // Animations controlled by CSS class highlight
                        break;
                    case 'box-3':
                        document.getElementById('false-mask').style.opacity = 1;
                        document.getElementById('false-mask').style.transform = 'scaleX(1)';
                        break;
                    case 'box-4':
                        // Animations controlled by CSS class highlight
                        break;
                    case 'box-5':
                        document.getElementById('rewriting-text').style.opacity = 1;
                        break;
                    case 'box-6':
                        document.getElementById('distorted-wave-1').style.opacity = 1;
                        document.getElementById('distorted-wave-2').style.opacity = 1;
                        document.getElementById('distorted-wave-3').style.opacity = 1;
                        break;
                    case 'box-7':
                        // Animations controlled by CSS class highlight
                        break;
                    case 'box-8':
                        // Animations controlled by CSS class highlight
                        break;
                    case 'box-9':
                        // Animations controlled by CSS class highlight
                        break;
                }
            }

            // Update button states
            prevBtn.disabled = currentStep === 0;
            nextBtn.disabled = currentStep === totalSteps;
        }

        nextBtn.addEventListener('click', () => {
            if (currentStep < totalSteps) {
                currentStep++;
                updateFlowchart();
            }
        });

        prevBtn.addEventListener('click', () => {
            if (currentStep > 0) {
                currentStep--;
                updateFlowchart();
            }
        });

        document.addEventListener('DOMContentLoaded', updateFlowchart);
    </script>
</body>
</html>
